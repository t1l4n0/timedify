{% comment %}
  Timedify App Embed Block: loads in <head> to reduce FOUC
{% endcomment %}

<style>
  /* Reserve layout; JS decides final visibility */
  [data-timedify-range] { visibility: hidden !important; }
  [data-timedify-range][data-timedify-hidden="true"] { display: none !important; visibility: hidden !important; }
  [data-timedify-range][data-timedify-hidden="false"] { display: block !important; visibility: visible !important; }
  .shopify-section[data-timedify-hidden="true"],
  .shopify-block[data-timedify-hidden="true"] { visibility: hidden !important; }
  .shopify-section[data-timedify-hidden="false"],
  .shopify-block[data-timedify-hidden="false"],
  [data-timedify-range][data-timedify-hidden="false"] { visibility: visible !important; }

  /* Hide timed sections immediately until controller marks them ready */
  .shopify-section[data-timedify-pending="true"] { visibility: hidden !important; }

  /* Scoped pre-hide within a section: content after Start is hidden until End */
  .shopify-section .timed-sections-start ~ * { display: none !important; visibility: hidden !important; }
  .shopify-section .timed-sections-end ~ * { display: initial !important; visibility: visible !important; }

  /* Stronger pre-hide using :has() (supported in evergreen browsers) */
  /* Single-section: hide siblings after start within the same section */
  .shopify-section:has(.timed-sections-start) .timed-sections-start ~ * { display: none !important; visibility: hidden !important; }
  .shopify-section:has(.timed-sections-end) .timed-sections-end ~ * { display: initial !important; visibility: visible !important; }

  /* Cross-section: hide sections following a section that contains a start marker */
  .shopify-section:has(.timed-sections-start) ~ .shopify-section { display: none !important; visibility: hidden !important; }
  /* Re-show sections following a section that contains an end marker */
  .shopify-section:has(.timed-sections-end) ~ .shopify-section { display: initial !important; visibility: visible !important; }
</style>

{% if section.settings.debug %}
<script>window.__timedifyDebug = true;</script>
{% endif %}

<!-- Tiny inline init: flag sections containing a start marker as pending (pre-hide) -->
<script>
  (function(){
    try {
      var starts = document.querySelectorAll('.timed-sections-start');
      for (var i = 0; i < starts.length; i++) {
        var sec = starts[i].closest('.shopify-section');
        if (sec) sec.dataset.timedifyPending = 'true';
      }
    } catch (e) {}
  })();
  </script>

<script src="{{ 'timedify-controller.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Timedify App Embed (Head)",
  "target": "head",
  "settings": [
    {
      "type": "checkbox",
      "id": "debug",
      "label": "Enable debug logging",
      "default": false
    }
  ]
}
{% endschema %}


