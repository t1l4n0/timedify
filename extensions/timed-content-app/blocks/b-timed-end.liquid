{% comment %}
  Timed Content End Block - marks the end of time-controlled content
{% endcomment %}

{% comment %}Check subscription status first{% endcomment %}
{% render 'timedify-subscription-check' %}
{% liquid
  assign subscription_active = shop.metafields.timedify.subscription_active.value | default: false
  if subscription_active == 'true' or subscription_active == true or subscription_active == 1
    assign timedify_should_load = true
  else
    assign timedify_should_load = false
  endif
%}

{% if timedify_should_load %}
{% if request.design_mode %}
<style>
.timedify-editor-spacing { margin: 32px 0; }
</style>
{% endif %}
<style>
.ts-hidden { display: none !important; }

.ts-end-marker {
  padding: 12px;
  border: 2px dashed #dc3545;
  border-radius: 6px;
  background: rgba(220, 53, 69, 0.06);
  font-size: 14px;
  text-align: left;
  margin: 0 !important;
  margin-left: 0 !important;
  padding-left: 0 !important;
  /* Override any parent container spacing */
  transform: translateX(0) !important;
  left: 0 !important;
}
</style>

{% if request.design_mode %}<div class="timedify-editor-spacing">{% endif %}
<div id="timed-sections-end-{{ block.id }}"
     class="timed-sections-end"
     data-end-datetime="{% if block.settings.end_date %}{{ block.settings.end_date }} {{ block.settings.end_time | default: '23:59' }}{% endif %}"
     style="{% unless request.design_mode %}display:none!important;{% endunless %}">
  {% if request.design_mode %}
  <div class="ts-end-marker">
    <div style="color: #dc3545; font-weight: 600; text-align: center;">
      Timed Content ends here.
    </div>
    {% if block.settings.end_date %}
      <div class="ts-display-only" style="text-align: center; margin-top: 6px;">
        End: {{ block.settings.end_date }}{% if block.settings.end_time and block.settings.end_time != blank and block.settings.end_time != '' and block.settings.end_time != ' ' %} {{ block.settings.end_time }}{% else %} 23:59{% endif %}
      </div>
    {% endif %}
  </div>
  {% else %}
  <!-- Display only on storefront -->
  <div style="color: #dc3545; font-weight: 600; text-align: center;">
    Timed Content ends here.
  </div>
  {% if block.settings.end_date %}
    <div class="ts-display-only" style="text-align: center; margin-top: 6px;">
      End: {{ block.settings.end_date }}{% if block.settings.end_time and block.settings.end_time != blank and block.settings.end_time != '' and block.settings.end_time != ' ' %} {{ block.settings.end_time }}{% else %} 23:59{% endif %}
    </div>
  {% endif %}
  {% endif %}
</div>
{% if request.design_mode %}</div>{% endif %}
{% elsif request.design_mode %}
<div class="timedify-editor-spacing">
<div class="ts-end-marker" style="padding:12px;border:1px solid #dc3545;border-radius:4px;background:#fff5f5;font-size:12px;">
  Timedify: Aktives Abo erforderlich. Der End-Block ist deaktiviert.
</div>
</div>
{% endif %}

{% schema %}
{
  "name": "2. Timed Content: End",
  "target": "section",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "‚è∞ End Time Settings"
    },
    {
      "type": "text",
      "id": "end_date",
      "label": "End Date",
      "placeholder": "DD.MM.YYYY",
      "default": "31.12.2025"
    },
    {
      "type": "text",
      "id": "end_time",
      "label": "End Time",
      "placeholder": "18:00",
      "default": "23:59"
    }
  ]
}
{% endschema %}